#### profile-plots per TF (marked outliers)
for(i in 1:42){
cc<-c("#9999CC","#CC6666")[data_long$colour+1]
p <- ggplot(data = data_long[data_long$TF==i,],
aes(x = dose, y = value, group = PID))
p+geom_line()+geom_point(colour=cc[data_long$TF==i])
ggsave(paste0("data2R/ROI1plots/",i,"_plot_",names_of_TFs[i,1],".tiff"))
}
rm(i, cc, p)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### outlier per TF in values:
outlierdf<-data.frame(TF=vector(), PID=vector())
for(i in 1:42){
temp<-data_long[data_long$TF==i,]
vv<-temp$value
iqr<-(quantile(vv, 0.75) -  quantile(vv, 0.25))
temp<-unique(temp[which(vv> quantile(vv, 0.75)+1.5*iqr  | vv < quantile(vv, 0.25) - 1.5*iqr),"PID"])
outlierdf<-rbind(outlierdf, data.frame(TF=rep(i, length(outliers)), PID=outliers))
}
summary(outlierdf)
unique(outlierdf$PID)
write.csv(outlierdf, file="data2R/ROI1_outlier_per_TF.csv", quote=F)
rm(i, iqr, vv, temp)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### Rank plot without outliers_ROI_Sizes:
data_long_noOutlier<-data_long[which(!(data_long$PID %in% outliers_ROI_Sizes)),]
data_long_noOutlier$PID<-factor(data_long_noOutlier$PID)
pdf("data2R/ROI1plots/rank_per_TF.pdf")
for(i in 1:42){
data_temp<-data_long_noOutlier[data_long_noOutlier$TF==i,]
rankMat<-aggregate(data_temp$value, by=list(data_temp$PID), rank)
plot(rankMat[,2][1,], type="l", main=paste0("ROI1: ", names_of_TFs[i,1]), xlab="dose", ylab="rank")
for(i in 2:length(unique(data_temp$PID))){
lines(rankMat[,2][i,])
lines(as.numeric(apply(rankMat[,2], 2, median)), col="red", lwd=4)
}
}
dev.off()
#library(R.matlab)
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("data2R/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("data2R/ROI1/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("data2R/ROI1/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("data2R/ROI1/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
rm(df, df2, i, fileNames, fileNames_ROI_Sizes, fileNames_TF_values)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1)$out)
dM<-cbind(PID=factor(rep(1:19, each=42)), dM)
dM<-cbind(TF=factor(rep(1:42, 19)), dM)
dM$colour<-1*(dM$PID %in% outliers_ROI_Sizes)
data_long <- gather(dM, dose, value, dose1:dose11, factor_key=TRUE)
#### profile-plots per TF (marked outliers)
for(i in 1:42){
cc<-c("#9999CC","#CC6666")[data_long$colour+1]
p <- ggplot(data = data_long[data_long$TF==i,],
aes(x = dose, y = value, group = PID))
p+geom_line()+geom_point(colour=cc[data_long$TF==i])
ggsave(paste0("data2R/ROI1plots/",i,"_plot_",names_of_TFs[i,1],".tiff"))
}
rm(i, cc, p)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### outlier per TF in values:
outlierdf<-data.frame(TF=vector(), PID=vector())
for(i in 1:42){
temp<-data_long[data_long$TF==i,]
vv<-temp$value
iqr<-(quantile(vv, 0.75) -  quantile(vv, 0.25))
temp<-unique(temp[which(vv> quantile(vv, 0.75)+1.5*iqr  | vv < quantile(vv, 0.25) - 1.5*iqr),"PID"])
outlierdf<-rbind(outlierdf, data.frame(TF=rep(i, length(outliers)), PID=outliers))
}
summary(outlierdf)
unique(outlierdf$PID)
write.csv(outlierdf, file="data2R/ROI1_outlier_per_TF.csv", quote=F)
rm(i, iqr, vv, temp)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### Rank plot without outliers_ROI_Sizes:
data_long_noOutlier<-data_long[which(!(data_long$PID %in% outliers_ROI_Sizes)),]
data_long_noOutlier$PID<-factor(data_long_noOutlier$PID)
pdf("data2R/ROI1plots/rank_per_TF.pdf")
for(i in 1:42){
data_temp<-data_long_noOutlier[data_long_noOutlier$TF==i,]
rankMat<-aggregate(data_temp$value, by=list(data_temp$PID), rank)
plot(rankMat[,2][1,], type="l", main=paste0("ROI1: ", names_of_TFs[i,1]), xlab="dose", ylab="rank")
for(i in 2:length(unique(data_temp$PID))){
lines(rankMat[,2][i,])
lines(as.numeric(apply(rankMat[,2], 2, median)), col="red", lwd=4)
}
}
dev.off()
rm(list=ls())
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("data2R/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("data2R/ROI2/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("data2R/ROI2/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("data2R/ROI2/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
rm(df, df2, i, fileNames, fileNames_ROI_Sizes, fileNames_TF_values)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1)$out)
dM<-cbind(PID=factor(rep(1:19, each=42)), dM)
dM<-cbind(TF=factor(rep(1:42, 19)), dM)
dM$colour<-1*(dM$PID %in% outliers_ROI_Sizes)
data_long <- gather(dM, dose, value, dose1:dose11, factor_key=TRUE)
#### profile-plots per TF (marked outliers)
for(i in 1:42){
cc<-c("#9999CC","#CC6666")[data_long$colour+1]
p <- ggplot(data = data_long[data_long$TF==i,],
aes(x = dose, y = value, group = PID))
p+geom_line()+geom_point(colour=cc[data_long$TF==i])
ggsave(paste0("data2R/ROI2plots/",i,"_plot_",names_of_TFs[i,1],".tiff"))
}
rm(i, cc, p)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### outlier per TF in values:
outlierdf<-data.frame(TF=vector(), PID=vector())
for(i in 1:42){
temp<-data_long[data_long$TF==i,]
vv<-temp$value
iqr<-(quantile(vv, 0.75) -  quantile(vv, 0.25))
temp<-unique(temp[which(vv> quantile(vv, 0.75)+1.5*iqr  | vv < quantile(vv, 0.25) - 1.5*iqr),"PID"])
outlierdf<-rbind(outlierdf, data.frame(TF=rep(i, length(outliers)), PID=outliers))
}
summary(outlierdf)
unique(outlierdf$PID)
write.csv(outlierdf, file="data2R/ROI2_outlier_per_TF.csv", quote=F)
rm(i, iqr, vv, temp)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### Rank plot without outliers:
data_long_noOutlier<-data_long[which(!(data_long$PID %in% outliers_ROI_Sizes)),]
data_long_noOutlier$PID<-factor(data_long_noOutlier$PID)
pdf("data2R/ROI2plots/rank_per_TF.pdf")
for(i in 1:42){
data_temp<-data_long_noOutlier[data_long_noOutlier$TF==i,]
rankMat<-aggregate(data_temp$value, by=list(data_temp$PID), rank)
plot(rankMat[,2][1,], type="l", main=paste0("ROI2: ", names_of_TFs[i,1]), xlab="dose", ylab="rank")
for(i in 2:length(unique(data_temp$PID))){
lines(rankMat[,2][i,])
lines(as.numeric(apply(rankMat[,2], 2, median)), col="red", lwd=4)
}
}
dev.off()
rm(all)
rm
#library(R.matlab)
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("data2R/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("data2R/ROI1/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("data2R/ROI1/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("data2R/ROI1/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
rm(df, df2, i, fileNames, fileNames_ROI_Sizes, fileNames_TF_values)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1)$out)
ggplot(outliers_ROI_Sizes)
ggplot( boxplot(dataSize, range=1))
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1,yaxt = "n")$out)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1)$out)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1,add = TRUE,col="white")$out)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1,add = TRUE,col="black")$out)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1,add = TRUE,col="white")$out)
gird()
grid()
rm(list=ls())
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("data2R/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("data2R/ROI2/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("data2R/ROI2/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("data2R/ROI2/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
rm(df, df2, i, fileNames, fileNames_ROI_Sizes, fileNames_TF_values)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1)$out)
dM<-cbind(PID=factor(rep(1:19, each=42)), dM)
dM<-cbind(TF=factor(rep(1:42, 19)), dM)
dM$colour<-1*(dM$PID %in% outliers_ROI_Sizes)
data_long <- gather(dM, dose, value, dose1:dose11, factor_key=TRUE)
#### profile-plots per TF (marked outliers)
for(i in 1:42){
cc<-c("#9999CC","#CC6666")[data_long$colour+1]
p <- ggplot(data = data_long[data_long$TF==i,],
aes(x = dose, y = value, group = PID))
p+geom_line()+geom_point(colour=cc[data_long$TF==i])
ggsave(paste0("data2R/ROI2plots/",i,"_plot_",names_of_TFs[i,1],".tiff"))
}
rm(i, cc, p)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### outlier per TF in values:
outlierdf<-data.frame(TF=vector(), PID=vector())
for(i in 1:42){
temp<-data_long[data_long$TF==i,]
vv<-temp$value
iqr<-(quantile(vv, 0.75) -  quantile(vv, 0.25))
temp<-unique(temp[which(vv> quantile(vv, 0.75)+1.5*iqr  | vv < quantile(vv, 0.25) - 1.5*iqr),"PID"])
outlierdf<-rbind(outlierdf, data.frame(TF=rep(i, length(outliers)), PID=outliers))
}
summary(outlierdf)
unique(outlierdf$PID)
write.csv(outlierdf, file="data2R/ROI2_outlier_per_TF.csv", quote=F)
rm(i, iqr, vv, temp)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### Rank plot without outliers:
data_long_noOutlier<-data_long[which(!(data_long$PID %in% outliers_ROI_Sizes)),]
data_long_noOutlier$PID<-factor(data_long_noOutlier$PID)
pdf("data2R/ROI2plots/rank_per_TF.pdf")
for(i in 1:42){
data_temp<-data_long_noOutlier[data_long_noOutlier$TF==i,]
rankMat<-aggregate(data_temp$value, by=list(data_temp$PID), rank)
plot(rankMat[,2][1,], type="l", main=paste0("ROI2: ", names_of_TFs[i,1]), xlab="dose", ylab="rank")
for(i in 2:length(unique(data_temp$PID))){
lines(rankMat[,2][i,])
lines(as.numeric(apply(rankMat[,2], 2, median)), col="red", lwd=4)
}
}
dev.off()
grid()
yaxis("gustav")
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1, ylab="Number of Voxel")$out)
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1, ylab="Number of Voxel")$out)
grid()
#library(R.matlab)
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("data2R/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("data2R/ROI1/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("data2R/ROI1/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("data2R/ROI1/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
rm(df, df2, i, fileNames, fileNames_ROI_Sizes, fileNames_TF_values)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1, ylab="Number of Voxel")$out)
grid()
dM<-cbind(PID=factor(rep(1:19, each=42)), dM)
dM<-cbind(TF=factor(rep(1:42, 19)), dM)
dM$colour<-1*(dM$PID %in% outliers_ROI_Sizes)
data_long <- gather(dM, dose, value, dose1:dose11, factor_key=TRUE)
#### profile-plots per TF (marked outliers)
for(i in 1:42){
cc<-c("#9999CC","#CC6666")[data_long$colour+1]
p <- ggplot(data = data_long[data_long$TF==i,],
aes(x = dose, y = value, group = PID))
p+geom_line()+geom_point(colour=cc[data_long$TF==i])
ggsave(paste0("data2R/ROI1plots/",i,"_plot_",names_of_TFs[i,1],".tiff"))
}
rm(i, cc, p)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### outlier per TF in values:
outlierdf<-data.frame(TF=vector(), PID=vector())
for(i in 1:42){
temp<-data_long[data_long$TF==i,]
vv<-temp$value
iqr<-(quantile(vv, 0.75) -  quantile(vv, 0.25))
temp<-unique(temp[which(vv> quantile(vv, 0.75)+1.5*iqr  | vv < quantile(vv, 0.25) - 1.5*iqr),"PID"])
outlierdf<-rbind(outlierdf, data.frame(TF=rep(i, length(outliers)), PID=outliers))
}
summary(outlierdf)
unique(outlierdf$PID)
write.csv(outlierdf, file="data2R/ROI1_outlier_per_TF.csv", quote=F)
rm(i, iqr, vv, temp)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### Rank plot without outliers_ROI_Sizes:
data_long_noOutlier<-data_long[which(!(data_long$PID %in% outliers_ROI_Sizes)),]
data_long_noOutlier$PID<-factor(data_long_noOutlier$PID)
pdf("data2R/ROI1plots/rank_per_TF.pdf")
for(i in 1:42){
data_temp<-data_long_noOutlier[data_long_noOutlier$TF==i,]
rankMat<-aggregate(data_temp$value, by=list(data_temp$PID), rank)
plot(rankMat[,2][1,], type="l", main=paste0("ROI1: ", names_of_TFs[i,1]), xlab="dose", ylab="rank")
for(i in 2:length(unique(data_temp$PID))){
lines(rankMat[,2][i,])
lines(as.numeric(apply(rankMat[,2], 2, median)), col="red", lwd=4)
}
}
dev.off()
dataSize
aggergate(dataSize)
aggregate(dataSize)
setwd("~/GitHub/TAToolbox/Matthias/02-Patients3MBq")
#library(R.matlab)
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("rank_test_and_outlier_specification/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("rank_test_and_outlier_specification/ROI1/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("rank_test_and_outlier_specification/ROI1/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("rank_test_and_outlier_specification/ROI1/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
rm(df, df2, i, fileNames, fileNames_ROI_Sizes, fileNames_TF_values)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1, ylab="Number of Voxel")$out)
grid()
dM<-cbind(PID=factor(rep(1:19, each=42)), dM)
dM<-cbind(TF=factor(rep(1:42, 19)), dM)
dM$colour<-1*(dM$PID %in% outliers_ROI_Sizes)
data_long <- gather(dM, dose, value, dose1:dose11, factor_key=TRUE)
#### profile-plots per TF (marked outliers)
for(i in 1:42){
cc<-c("#9999CC","#CC6666")[data_long$colour+1]
p <- ggplot(data = data_long[data_long$TF==i,],
aes(x = dose, y = value, group = PID))
p+geom_line()+geom_point(colour=cc[data_long$TF==i])
ggsave(paste0("rank_test_and_outlier_specification/ROI1plots/",i,"_plot_",names_of_TFs[i,1],".tiff"))
}
rm(i, cc, p)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### outlier per TF in values:
outlierdf<-data.frame(TF=vector(), PID=vector())
for(i in 1:42){
temp<-data_long[data_long$TF==i,]
vv<-temp$value
iqr<-(quantile(vv, 0.75) -  quantile(vv, 0.25))
temp<-unique(temp[which(vv> quantile(vv, 0.75)+1.5*iqr  | vv < quantile(vv, 0.25) - 1.5*iqr),"PID"])
outlierdf<-rbind(outlierdf, data.frame(TF=rep(i, length(outliers)), PID=outliers))
}
summary(outlierdf)
unique(outlierdf$PID)
write.csv(outlierdf, file="rank_test_and_outlier_specification/ROI1_outlier_per_TF.csv", quote=F)
rm(i, iqr, vv, temp)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### Rank plot without outliers_ROI_Sizes:
data_long_noOutlier<-data_long[which(!(data_long$PID %in% outliers_ROI_Sizes)),]
data_long_noOutlier$PID<-factor(data_long_noOutlier$PID)
pdf("rank_test_and_outlier_specification/ROI1plots/rank_per_TF.pdf")
for(i in 1:42){
data_temp<-data_long_noOutlier[data_long_noOutlier$TF==i,]
rankMat<-aggregate(data_temp$value, by=list(data_temp$PID), rank)
plot(rankMat[,2][1,], type="l", main=paste0("ROI1: ", names_of_TFs[i,1]), xlab="dose", ylab="rank")
for(i in 2:length(unique(data_temp$PID))){
lines(rankMat[,2][i,])
lines(as.numeric(apply(rankMat[,2], 2, median)), col="red", lwd=4)
}
}
dev.off()
#### Daten einlesen
names_of_TFs<-read.csv("rank_test_and_outlier_specification/Zuordnung-TFs-to-Number.csv")
#library(R.matlab)
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("rank_test_and_outlier_specification/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("rank_test_and_outlier_specification/ROI1/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("rank_test_and_outlier_specification/ROI1/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("rank_test_and_outlier_specification/ROI1/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
rm(df, df2, i, fileNames, fileNames_ROI_Sizes, fileNames_TF_values)
###################################################################################
#### Ausreisser definieren & long-format
outliers_ROI_Sizes<-which(dataSize %in% boxplot(dataSize, range=1, ylab="Number of Voxel")$out)
grid()
dM<-cbind(PID=factor(rep(1:19, each=42)), dM)
dM<-cbind(TF=factor(rep(1:42, 19)), dM)
dM$colour<-1*(dM$PID %in% outliers_ROI_Sizes)
data_long <- gather(dM, dose, value, dose1:dose11, factor_key=TRUE)
#### profile-plots per TF (marked outliers)
for(i in 1:42){
cc<-c("#9999CC","#CC6666")[data_long$colour+1]
p <- ggplot(data = data_long[data_long$TF==i,],
aes(x = dose, y = value, group = PID))
p+geom_line()+geom_point(colour=cc[data_long$TF==i])
ggsave(paste0("rank_test_and_outlier_specification/ROI1plots/",i,"_plot_",names_of_TFs[i,1],".tiff"))
}
rm(i, cc, p)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### outlier per TF in values:
outlierdf<-data.frame(TF=vector(), PID=vector())
for(i in 1:42){
temp<-data_long[data_long$TF==i,]
vv<-temp$value
iqr<-(quantile(vv, 0.75) -  quantile(vv, 0.25))
temp<-unique(temp[which(vv> quantile(vv, 0.75)+1.5*iqr  | vv < quantile(vv, 0.25) - 1.5*iqr),"PID"])
outlierdf<-rbind(outlierdf, data.frame(TF=rep(i, length(outliers)), PID=outliers))
}
summary(outlierdf)
unique(outlierdf$PID)
write.csv(outlierdf, file="rank_test_and_outlier_specification/ROI1_outlier_per_TF.csv", quote=F)
rm(i, iqr, vv, temp)
####~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#### Rank plot without outliers_ROI_Sizes:
data_long_noOutlier<-data_long[which(!(data_long$PID %in% outliers_ROI_Sizes)),]
data_long_noOutlier$PID<-factor(data_long_noOutlier$PID)
pdf("rank_test_and_outlier_specification/ROI1plots/rank_per_TF.pdf")
for(i in 1:42){
data_temp<-data_long_noOutlier[data_long_noOutlier$TF==i,]
rankMat<-aggregate(data_temp$value, by=list(data_temp$PID), rank)
plot(rankMat[,2][1,], type="l", main=paste0("ROI1: ", names_of_TFs[i,1]), xlab="dose", ylab="rank")
for(i in 2:length(unique(data_temp$PID))){
lines(rankMat[,2][i,])
lines(as.numeric(apply(rankMat[,2], 2, median)), col="red", lwd=4)
}
}
dev.off()
View(outlierdf)
View(rankMat)
dataSize
dataSize
rm(list=ls())
library("tidyr")
library(tidyr)
library(ggplot2)
#### Daten einlesen
names_of_TFs<-read.csv("rank_test_and_outlier_specification/Zuordnung-TFs-to-Number.csv")
fileNames<-list.files("rank_test_and_outlier_specification/ROI2/")
fileNames_TF_values<-fileNames[!grepl("ROI", fileNames)]
fileNames_ROI_Sizes<-fileNames[grepl("ROI", fileNames)]
dM<-data.frame()
dataSize<-vector()
for(i in 1:length(fileNames_TF_values)){
df<-read.csv(paste0("rank_test_and_outlier_specification/ROI2/", fileNames_TF_values[i]), header=F)[,1:11]
colnames(df)<-paste0("dose", 1:11)
rownames(df)<-paste0("TF", 1:42)
dM<-rbind(dM, df)
df2<-read.csv(paste0("rank_test_and_outlier_specification/ROI2/", fileNames_ROI_Sizes[i]), header=F)
dataSize[i]<-df2[1,1]
}
dataSize
